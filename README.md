# Mailer

**Githubは開発中のバージョンです。**開発バージョンでは、テスト中のコードも含むため意図しない不具合が発生する可能性があります。
開発以外では最新パッケージをパブリッシャーのサイトから[ダウンロード](https://walkyxwalky.com/download)してご利用ください。

## 特徴

Slim Framework 4 製のADR（Action-Domain-Responder）パターンを取り入れたモダンでシンプルなメールフォームです。

静的HTMLなど自由なページからの送信、または内部Twigテンプレートからの送信の両側面からのPOSTをサポートしています。

そのため、WordPressなどのCMSや、Laravelといったフレームワークなど既存システムに組み込むことができます。

提供する機能はメールの送信プロセスに特化しているため、パスワードを必要とする管理画面を持ちません。
それはセキュリティ面でのリスク回避と、他CMSやフレームワークとの連携を容易にします。

## 機能

- CSRF対策（slim/csrf対応）
- BOT対策（reCAPTCHAv3対応）
- リファラチェックによる指定ドメインのみのPOST受付
- ワンタイムトークンによる連続投稿を防止
- 基本的なバリデーション機能（valitron,email-validator対応）
- 数字の全角を半角に自動変換
- 自動応答メールの送信
- 確認画面の有無
- 日本語含む投稿をチェック
- 禁止ワードの設定
- ブロックメールアドレスの設定
- 自由なフォームデザイン（Twigテンプレート対応）
- 自由なメールデザイン（Twigテンプレート,PHPテンプレート対応）
- HTMLメール対応
- 他CMSとの共存可能
- ヘルスチェック機能
- ディレクトリの自由配置（Settings,Templates,Public）
- メールハンドラーの切り替え（PHPMailer,wp_mail関数）
- 履歴のデータベース保存（MariaDB,MySQL,SQLite）
- Logger搭載（Monolog）
- JavaScriptのAjaxライブラリ同梱（CSRFトークン,reCAPTCHAトークン,Bootstrap v5）

### 将来実装予定

- 添付ファイル対応
- 多言語のバリデーション応答
- CRONで定期レポートの送信

## 設置方法

### Step.1

publicフォルダは任意の場所に移動ができます。
移動させたらメールプログラムのルートにある bootstrap.php までのパスを指定してください。

~~~
require_once __DIR__ . '/../../mailer/bootstrap.php';
~~~

### Step.2

環境設定 env.sample.txt を .env にリネームして内容を編集します。.envの環境設定は settings ディレクトリ内の各PHPファイルを通り再設定されます。

### Step.3

環境設定のDEBUGをtrueにしてデバッグモードで publicフォルダのルートにアクセスしてください。
セットアップ方法が表示されますので、ガイドに沿ってフォームの内容をカスタマイズしてみましょう

---

### プログラムは公開ディレクトリの外に設置を推奨

メールプログラムのルートにある bootstrap.php を起点にすべてのプログラムを読み込みます。

試しにメールプログラム直下のpublicフォルダを任意の場所に移動してみましょう。

移動させたら publicフォルダ内の index.php と htaccess.txt を編集してください。
フォルダ名も public から自由に変更してください。

メールプログラムは公開ディレクトリの外（HTTPでアクセスできない場所）に設置することを推奨します。

#### !!プログラムを公開ディレクトリ内に設置している場合!!

公開ディレクトリにプログラムを設置している場合は、coreディレクトリにアクセス制限をかけましょう。
coreの中のlogsディレクトリはメール送信失敗などのログファイルが残ります。
また、SQLiteを使用している場合もDBの場所に気をつけてください。

## 開発環境のクローン

開発環境をクローンしてどなたでも開発に参加いただけます。

~~~
git clone https://github.com/elkulo/Mailer.git Mailer
cd Mailer
npm install
~~~

### コマンドライン

#### 開発

PHPのビルドサーバーとWebpack(非圧縮)の監視サーバーが起動します。

~~~
npm run start
~~~
